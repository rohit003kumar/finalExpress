const i=async(a,o)=>{const n=[async()=>{const e=await(await fetch(`https://api.opencagedata.com/geocode/v1/json?q=${a}+${o}&key=fbddd9ac0aff4feb840edc8d63a8f264&language=en&countrycode=in`)).json();if(e.results&&e.results.length>0)return e.results[0].formatted;throw new Error("No results from OpenCage")},async()=>{const e=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${a}&lon=${o}&zoom=18&addressdetails=1&accept-language=en`)).json();if(e.display_name)return e.display_name;throw new Error("No results from Nominatim")},async()=>{const e=await(await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${a}&longitude=${o}&localityLanguage=en`)).json();if(e.locality&&e.city)return`${e.locality}, ${e.city}, ${e.countryName}`;throw new Error("No results from BigDataCloud")}];for(const r of n)try{const e=await r();if(e&&e.trim())return e}catch(e){console.warn("Geocoding service failed:",e);continue}return`${a.toFixed(6)}, ${o.toFixed(6)}`},d=()=>new Promise((a,o)=>{if(!localStorage.getItem("token")){o(new Error("Please log in to use location services"));return}if(!navigator.geolocation){o(new Error("Geolocation is not supported by this browser"));return}const r={enableHighAccuracy:!0,timeout:2e4,maximumAge:0};navigator.geolocation.getCurrentPosition(async e=>{const{latitude:t,longitude:s}=e.coords;console.log("Location accuracy:",{accuracy:e.coords.accuracy,altitude:e.coords.altitude,altitudeAccuracy:e.coords.altitudeAccuracy,heading:e.coords.heading,speed:e.coords.speed});try{const c=await i(t,s);a({lat:t,lng:s,address:c})}catch{a({lat:t,lng:s,address:`${t.toFixed(6)}, ${s.toFixed(6)}`})}},e=>{let t="Unable to retrieve your location";switch(e.code){case e.PERMISSION_DENIED:t="Location access denied by user. Please allow location access in your browser settings.";break;case e.POSITION_UNAVAILABLE:t="Location information is unavailable. Please check your GPS settings and try again.";break;case e.TIMEOUT:t="Location request timed out. Please try again in a better signal area.";break}o(new Error(t))},r)});export{d as getCurrentLocation,i as reverseGeocode};
